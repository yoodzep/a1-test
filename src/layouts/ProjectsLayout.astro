---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Kicker from "@/components/fundations/elements/Kicker.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Components
import ProjectCardSmall from "@/components/projects/ProjectCardSmall.astro";
import KeenSliderProjectLayout from "@/components/fundations/scripts/KeenSliderProjectLayout.astro";
import Button from "@/components/fundations/elements/Button.astro";
import ArrowLeft from "@/components/fundations/icons/ArrowLeft.astro";
import ArrowRight from "@/components/fundations/icons/ArrowRight.astro";
// Content
import { getCollection } from "astro:content";
const { frontmatter } = Astro.props;
const meta = [frontmatter.category, frontmatter.location, frontmatter.year]
  .filter(Boolean)
  .join(" â€¢ ");
const allProjects = await getCollection("projects");
const latestProjects = allProjects
  .filter((project) => project.data.title !== frontmatter.title)
  .slice(0, 3);
---

<BaseLayout navTransparent={true}>
  <section class="relative flex flex-col bg-accent-950">
    <Wrapper
      variant="standard"
      class="py-12 pt-48 lg:border-x lg:border-white/10"
    >
      <div class="grid grid-cols-1 lg:grid-cols-3 lg:items-end gap-12">
        <div class="max-w-xl text-balance lg:col-span-2">
          <Kicker class="text-secondary-500"> {meta}</Kicker>
          <Text
            tag="h1"
            variant="displayMD"
            class="text-white font-semibold tracking-tight mt-12"
          >
            {frontmatter.title}
          </Text>
          <Text tag="p" variant="textLG" class="text-white max-w-xl mt-4">
            {frontmatter.description}
          </Text>
        </div>
        <ul role="list" class="space-y-1 list-none">
          {
            frontmatter.services.map((service) => (
              <li>
                <Text tag="p" variant="textSM" class="text-alternative-300 ">
                  {service}
                </Text>
              </li>
            ))
          }
        </ul>
      </div>
    </Wrapper>
  </section>
  <section>
    <Wrapper variant="paddingless">
      <Image
        width={1400}
        height={1400}
        loading="lazy"
        decoding="async"
        src={frontmatter.cover.url}
        alt={frontmatter.cover.alt || frontmatter.title}
        class="object-cover object-center w-full max-h-120"
      />
    </Wrapper>
  </section>
  <section>
    <Wrapper variant="standard" class="py-12">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        {
          frontmatter.metrics.map((metric) => (
            <div class="bg-base-50 p-8 rounded pt-24 lg:pt-48">
              <Text
                tag="p"
                variant="displayLG"
                class="text-accent-900 italic font-semibold"
              >
                {metric.value}
              </Text>
              <Text
                tag="p"
                variant="textLG"
                class="text-base-500 font-medium mt-2"
              >
                {metric.label}
              </Text>
            </div>
          ))
        }
      </div>
    </Wrapper>
  </section>
  <section>
    <Wrapper variant="standard" class="py-12">
      <div class="bg-accent-950 p-8 rounded lg:pr-0">
        {
          frontmatter.gallery && (
            <div
              id="project-slider-container-gallery"
              class="grid gird-cols-1 lg:grid-cols-3 gap-8 "
            >
              <div class="flex flex-col h-full gap-4 justify-between  rounded order-last lg:order-first ">
                <Text
                  tag="h3"
                  variant="displaySM"
                  class="font-medium text-white"
                >
                  Gallery
                </Text>
                <div class="flex j gap-2 mt-4">
                  <Button
                    iconOnly
                    size="xs"
                    variant="muted"
                    aria-label="Previous image"
                    class="project-slider-prev"
                  >
                    <ArrowLeft size="sm" slot="icon" />
                  </Button>
                  <Button
                    iconOnly
                    size="xs"
                    variant="muted"
                    aria-label="Next image"
                    class="project-slider-next"
                  >
                    <ArrowRight size="sm" slot="icon" />
                  </Button>
                </div>
              </div>
              <div
                class="keen-slider lg:col-span-2"
                id="project-gallery-slider"
              >
                <div class="keen-slider__slide">
                  <Image
                    src={frontmatter.cover.url}
                    alt={frontmatter.cover.alt || frontmatter.title}
                    width={800}
                    height={600}
                    loading="lazy"
                    decoding="async"
                    class="object-cover object-center w-full  rounded aspect-square"
                  />
                </div>
                {frontmatter.gallery.map((img) => (
                  <div class="keen-slider__slide ">
                    <Image
                      src={img.url}
                      alt={img.alt || frontmatter.title}
                      width={800}
                      height={600}
                      loading="lazy"
                      decoding="async"
                      class="object-cover object-center w-full  rounded aspect-square"
                    />
                  </div>
                ))}
              </div>
            </div>
          )
        }
      </div>
    </Wrapper>
  </section>
  <Wrapper variant="standard" class="py-12">
    <Wrapper variant="narrow" class="mx-auto">
      <Wrapper variant="prose">
        <slot />
      </Wrapper>
    </Wrapper>
  </Wrapper>
  {
    latestProjects.length > 0 && (
      <section>
        <Wrapper variant="standard" class="py-24">
          <div class="flex flex-col md:flex-row gap-4 md:items-center justify-between">
            <Text
              tag="h2"
              variant="displaySM"
              class="font-semibold tracking-tighter  text-accent-900"
            >
              Latest projects
            </Text>
            <Button
              isLink
              size="xs"
              variant="default"
              href="/projects"
              class="w-fit"
            >
              See all projects
            </Button>
          </div>
          <div class="flex flex-col mt-12 lg:mt-24 space-y-8">
            {latestProjects.map((project) => (
              <ProjectCardSmall project={project} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }
</BaseLayout>
<KeenSliderProjectLayout />
